<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¯­æ³•æ ‘å¯è§†åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/viz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/full.render.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        select, button {
            padding: 8px 15px;
            font-size: 14px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background: #45a049;
        }
        #graph {
            border: 1px solid #ddd;
            padding: 20px;
            background: white;
            overflow: auto;
            margin-top: 20px;
        }
        .info {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #2196F3;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ² è¯­æ³•æ ‘å¯è§†åŒ–å·¥å…·</h1>
        
        <div class="info">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>é€‰æ‹©DOTæ–‡ä»¶åç‚¹å‡»"åŠ è½½å¹¶æ¸²æŸ“"æŒ‰é’®ï¼Œæˆ–ç›´æ¥åœ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´DOTä»£ç 
        </div>
        
        <div class="controls">
            <input type="file" id="fileInput" accept=".dot">
            <button onclick="renderFromFile()">ğŸ“‚ åŠ è½½å¹¶æ¸²æŸ“</button>
            <button onclick="renderExample()">ğŸ¨ æ¸²æŸ“ç¤ºä¾‹</button>
            <button onclick="exportImage()">ğŸ’¾ å¯¼å‡ºPNG</button>
        </div>
        
        <details>
            <summary style="cursor: pointer; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                <strong>ğŸ“ æˆ–ç›´æ¥ç²˜è´´DOTä»£ç </strong>
            </summary>
            <textarea id="dotInput" rows="10" style="width: 100%; margin-top: 10px; padding: 10px; font-family: monospace;"></textarea>
            <button onclick="renderFromText()" style="margin-top: 10px;">âœ¨ æ¸²æŸ“</button>
        </details>
        
        <div id="graph"></div>
    </div>

    <script>
        let viz = null;
        
        // åˆå§‹åŒ–Viz.js
        Viz.instance().then(instance => {
            viz = instance;
            console.log("Viz.js initialized");
        });

        function renderFromFile() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ª.dotæ–‡ä»¶');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const dotContent = e.target.result;
                renderDot(dotContent);
            };
            
            reader.readAsText(file);
        }

        function renderFromText() {
            const dotInput = document.getElementById('dotInput');
            const dotContent = dotInput.value.trim();
            
            if (!dotContent) {
                alert('è¯·è¾“å…¥DOTä»£ç ');
                return;
            }
            
            renderDot(dotContent);
        }

        function renderDot(dotContent) {
            if (!viz) {
                alert('Viz.jsè¿˜æœªåŠ è½½å®Œæˆï¼Œè¯·ç¨å€™å†è¯•');
                return;
            }
            
            try {
                viz.renderSVGElement(dotContent)
                    .then(element => {
                        const graphDiv = document.getElementById('graph');
                        graphDiv.innerHTML = '';
                        graphDiv.appendChild(element);
                    })
                    .catch(error => {
                        alert('æ¸²æŸ“å¤±è´¥ï¼š' + error.message);
                        console.error(error);
                    });
            } catch (error) {
                alert('æ¸²æŸ“å‡ºé”™ï¼š' + error.message);
                console.error(error);
            }
        }

        function renderExample() {
            const exampleDot = `digraph ParseTree {
    node [shape=box, fontname="Arial"];
    edge [fontname="Arial"];
    
    node0 [label="S\\n[S -> E]", fillcolor="lightblue", style=filled];
    node1 [label="E\\n[E -> E + T]", fillcolor="lightblue", style=filled];
    node0 -> node1;
    
    node2 [label="E\\n[E -> T]", fillcolor="lightblue", style=filled];
    node1 -> node2;
    
    node3 [label="T\\n[T -> F]", fillcolor="lightblue", style=filled];
    node2 -> node3;
    
    node4 [label="F\\n[F -> id]", fillcolor="lightblue", style=filled];
    node3 -> node4;
    
    node5 [label="id\\na", fillcolor="lightgreen", style=filled];
    node4 -> node5;
    
    node6 [label="+\\n+", fillcolor="lightgreen", style=filled];
    node1 -> node6;
    
    node7 [label="T\\n[T -> F]", fillcolor="lightblue", style=filled];
    node1 -> node7;
    
    node8 [label="F\\n[F -> id]", fillcolor="lightblue", style=filled];
    node7 -> node8;
    
    node9 [label="id\\nb", fillcolor="lightgreen", style=filled];
    node8 -> node9;
}`;
            renderDot(exampleDot);
        }

        function exportImage() {
            const svg = document.querySelector('#graph svg');
            if (!svg) {
                alert('è¯·å…ˆæ¸²æŸ“ä¸€ä¸ªè¯­æ³•æ ‘');
                return;
            }
            
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svg);
            const blob = new Blob([svgString], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'parse_tree.svg';
            a.click();
        }
    </script>
</body>
</html>
