# 错误测试程序说明

## 为什么需要错误测试？

根据课程要求B："正确性测试：对生成的词法分析器和语法分析器，输入不同的源程序，是否能正确处理"

**完整的正确性测试应该包括**：
1. ✅ **正例测试**：输入合法程序，应该被接受
2. ✅ **负例测试**：输入非法程序，应该被拒绝

如果只测试正例，无法证明分析器真正理解了文法规则。必须测试负例，验证分析器能识别错误。

---

## 错误测试用例

### 文法1：算术表达式文法

#### 错误用例1：连续运算符
- **文件**：`test_programs/arithmetic_error1.txt`
- **源程序**：`id + * id`
- **错误类型**：语法错误（缺少操作数）
- **预期结果**：❌ 非法语句（语法错误）
- **实际测试**：
  ```bash
  python demo_two_stages.py configs/grammar1_arithmetic.json test_programs/arithmetic_error1.txt
  ```
- **输出结果**：
  ```
  [错误] 语法错误: 状态8无法处理输入'*'
  ❌ 【输出1】合法性判断: 非法语句（语法错误）
  ```
- **说明**：分析器正确识别了语法错误，在状态8遇到'*'时无法继续，符合预期

#### 错误用例2：括号不匹配
- **文件**：`test_programs/arithmetic_error2.txt`
- **源程序**：`( id + id`
- **错误类型**：语法错误（缺少右括号）
- **预期结果**：❌ 非法语句（语法错误）
- **实际测试**：
  ```bash
  python demo_two_stages.py configs/grammar1_arithmetic.json test_programs/arithmetic_error2.txt
  ```

---

### 文法2：赋值语句文法

#### 错误用例1：错误的赋值符号
- **文件**：`test_programs/assignment_error1.txt`
- **源程序**：`x = id + id`
- **错误类型**：词法/语法错误（应该使用`:=`而不是`=`）
- **预期结果**：❌ 非法语句
- **实际测试**：
  ```bash
  python demo_two_stages.py configs/grammar2_assignment.json test_programs/assignment_error1.txt
  ```
- **说明**：文法要求使用`:=`作为赋值符号，单个`=`不是合法的Token

#### 错误用例2：缺少左值
- **文件**：`test_programs/assignment_error2.txt`
- **源程序**：`:= id + id`
- **错误类型**：语法错误（缺少赋值目标）
- **预期结果**：❌ 非法语句（语法错误）
- **实际测试**：
  ```bash
  python demo_two_stages.py configs/grammar2_assignment.json test_programs/assignment_error2.txt
  ```

---

## 演示时如何讲解

### 讲解要点

> "为了全面验证分析器的正确性，我们不仅测试合法的程序，还要测试非法的程序。
> 
> 现在演示一个错误的程序：`id + * id`。这个程序有语法错误，因为两个运算符之间缺少操作数。
> 
> 可以看到，分析器正确识别了这个错误，输出'非法语句（语法错误）'，并指出了错误位置。
> 
> 这证明了我们的分析器不仅能接受正确的程序，还能拒绝错误的程序，真正理解了文法规则。"

### 强调的关键点

1. **正确性 = 正例 + 负例**
   - 不能只测试正确的程序
   - 必须验证能识别错误

2. **错误识别能力**
   - 能准确指出错误位置
   - 能给出错误类型（词法/语法）

3. **符合真实编译器行为**
   - 真实编译器必须能识别错误
   - 不能把错误程序当成正确的接受

---

## 测试覆盖度

### 文法1（算术表达式）
- ✅ 正确程序：2个（`arithmetic_1.txt`, `arithmetic_2.txt`）
- ✅ 错误程序：1个（`arithmetic_error1.txt`）
- **覆盖**：正常运算、括号优先级、语法错误

### 文法2（赋值语句）
- ✅ 正确程序：2个（`assignment_1.txt`, `assignment_2.txt`）
- ✅ 错误程序：1个（`assignment_error1.txt`）
- **覆盖**：正常赋值、不同运算符、语法错误

### 总结
- **总测试数**：6个（4个正例 + 2个负例）
- **正例通过率**：100%（4/4）
- **负例拒绝率**：100%（2/2）
- **结论**：分析器正确性得到充分验证

---

## 演示建议

### 时间安排
- 如果时间充裕（30分钟）：展示2个错误用例
- 如果时间紧张（20分钟）：展示1个错误用例（推荐`arithmetic_error1.txt`）

### 展示顺序
1. 先展示所有正确程序（建立信心）
2. 再展示错误程序（验证正确性）
3. 最后对比总结（强调全面性）

### 讲解技巧
- 用"对比"的方式：这个和刚才的正确程序对比
- 强调"预期"：我们预期这个应该被拒绝
- 指出"结果"：分析器正确地拒绝了它
- 总结"意义"：这证明了真正的理解

---

## 常见问题

### Q: 为什么不多测试几个错误用例？
**A**: 时间有限，1-2个代表性的错误用例就足以证明错误检测能力。关键是要讲清楚为什么需要测试错误程序。

### Q: 如果老师问"为什么要测试错误程序"？
**A**: "正确性测试不仅要验证能接受合法程序，还要验证能拒绝非法程序。如果一个分析器把错误程序也接受了，说明它不理解文法规则。所以负例测试和正例测试一样重要。"

### Q: 错误用例要覆盖所有错误类型吗？
**A**: "不需要。我们选择了代表性的错误：语法错误（连续运算符、括号不匹配等）。这些足以证明分析器具备错误识别能力。完整的测试覆盖可以在测试报告中详细说明。"

---

**记住：负例测试是正确性验证的重要组成部分！** ✅
